<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Horario Semanal de Operadores</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    h1 { margin-bottom: .5rem; }
    .controls { margin-bottom: 1rem; }
    .controls button, .controls input { margin-right: .5rem; }
    table { border-collapse: collapse; width: 100%; max-width: 800px; }
    th, td { border: 1px solid #ccc; padding: 4px 8px; text-align: center; cursor: pointer; }
    th { background: #f0f0f0; cursor: default; }
    .rest { background: #f88; }
    .work { background: #8f8; }
  </style>
</head>
<body>
  <h1>Horario Semanal de Operadores</h1>
  <div class="controls">
    <button id="prev">« Semana anterior</button>
    <button id="next">Semana siguiente »</button>
    <label>
      Fecha (cualquier día):
      <input type="date" id="weekInput" />
    </label>
    <button id="load">Cargar semana</button>
  </div>
  <div id="schedule"></div>
  <script>
    const baseSchedule = [
      [1,1,1,1,0,0],[1,1,0,0,1,1],[0,0,1,1,1,1],[1,1,1,0,0,1],[0,1,1,1,1,0],
      [1,0,0,1,1,1],[1,1,1,0,0,1],[0,0,1,1,1,1],[1,1,0,1,1,0],[0,1,1,0,1,1]
    ];
    const names = ["Ruben","Eduardo","Gabriel","Rebeca","David","Enrique","Mariel","René","Josué","Heidi"];
    const overrides = {};
    function getMonday(d) {
      const date = new Date(d);
      const day = date.getDay();
      const diff = (day + 6) % 7;
      date.setDate(date.getDate() - diff);
      return date;
    }
    function weekIndex(monday) {
      const base = new Date('2025-06-30');
      const diffMs = monday - getMonday(base);
      return Math.floor(diffMs / (7*24*60*60*1000));
    }
    function renderWeek(monday) {
      const container = document.getElementById('schedule'); container.innerHTML = '';
      const idx = weekIndex(monday);
      const rot = ((idx % names.length) + names.length) % names.length;
      const order = names.slice(rot).concat(names.slice(0,rot));
      const ymd = monday.toISOString().slice(0,10);
      if (!overrides[ymd]) overrides[ymd] = { days: {}, swap: [] };
      const dates = [];
      for (let i=0;i<7;i++) {
        const d = new Date(monday);
        d.setDate(d.getDate()+i);
        dates.push(d);
      }
      const tbl = document.createElement('table');
      const thead = document.createElement('thead');
      let headHtml = '<tr><th>Sindicalizado</th>';
      dates.forEach((d,i) => {
        const nm = ['Lun','Mar','Mié','Jue','Vie','Sáb','Dom'][i];
        headHtml += `<th>${nm}<br>${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}</th>`;
      });
      headHtml += '<th>Hrs</th></tr>';
      thead.innerHTML = headHtml;
      tbl.appendChild(thead);
      const tbody = document.createElement('tbody');
      order.forEach((name,i) => {
        let hrs = 0;
        const row = document.createElement('tr');
        const cell = document.createElement('td');
        cell.textContent = name;
        cell.style.cursor = 'default';
        row.appendChild(cell);
        for (let d=0; d<7; d++) {
          const baseOn = (d<6 ? baseSchedule[i][d] : 0);
          const customList = overrides[ymd].days[name] || [];
          const on = customList.includes(d) ? 1 : baseOn;
          const text = on ? 'Turno' : 'Descanso';
          const cls = on ? 'work' : 'rest';
          const ctd = document.createElement('td');
          ctd.textContent = text;
          ctd.className = cls;
          ctd.dataset.name = name;
          ctd.dataset.day = d;
          ctd.onclick = toggleCell;
          if (on) hrs += 12;
          row.appendChild(ctd);
        }
        const hrsCell = document.createElement('td');
        hrsCell.textContent = hrs;
        hrsCell.style.cursor = 'default';
        row.appendChild(hrsCell);
        tbody.appendChild(row);
      });
      tbl.appendChild(tbody);
      container.appendChild(tbl);
    }
    function toggleCell(e) {
      const td = e.currentTarget;
      const name = td.dataset.name;
      const d = parseInt(td.dataset.day, 10);
      const inpVal = document.getElementById('weekInput').value;
      if (!inpVal) return;
      const monday = getMonday(new Date(inpVal));
      const ymd = monday.toISOString().slice(0,10);
      if (!overrides[ymd]) overrides[ymd] = { days: {}, swap: [] };
      if (!overrides[ymd].days) overrides[ymd].days = {};
      if (!overrides[ymd].days[name]) overrides[ymd].days[name] = [];
      const idx = overrides[ymd].days[name].indexOf(d);
      if (idx >= 0) overrides[ymd].days[name].splice(idx,1);
      else overrides[ymd].days[name].push(d);
      renderWeek(monday);
    }
    let currentMonday;
    document.getElementById('prev').onclick = () => { currentMonday.setDate(currentMonday.getDate()-7); updateUI(); };
    document.getElementById('next').onclick = () => { currentMonday.setDate(currentMonday.getDate()+7); updateUI(); };
    document.getElementById('load').onclick = () => {
      const inp = document.getElementById('weekInput').value;
      if (!inp) return;
      currentMonday = getMonday(new Date(inp));
      updateUI();
    };
    function updateUI() {
      document.getElementById('weekInput').value = currentMonday.toISOString().slice(0,10);
      renderWeek(currentMonday);
    }
    window.addEventListener('DOMContentLoaded', () => {
      currentMonday = getMonday(new Date());
      updateUI();
    });
  </script>
</body>
</html>
